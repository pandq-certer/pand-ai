# 华北数据库团队资源规划系统 - 需求文档

## 📋 文档信息

| 项目 | 信息 |
|------|------|
| **项目名称** | 华北数据库团队资源规划系统 |
| **版本** | v2.0.0 |
| **文档版本** | 1.0 |
| **编写日期** | 2025-01-11 |
| **项目类型** | 团队资源管理系统 |

---

## 1. 项目概述

### 1.1 项目背景

华北数据库团队负责多个重要项目的开发和维护，包括 FinTech 迁移、实时账本、审计日志 2.0 等核心项目。团队由 DBA、数据工程师、后端开发、ETL 开发、数据分析师等不同角色组成。

**问题与挑战**：
- 资源分配缺乏可视化，难以快速了解团队资源分布
- 项目进度与资源投入无法有效追踪
- 成员跨项目协作，资源冲突难以协调
- 历史数据难以追溯和分析
- 资源过度分配或分配不足的情况难以发现

### 1.2 项目目标

**主要目标**：
1. 提供直观的资源分配矩阵，实时展示团队成员在各项目上的投入
2. 支持按周为成员分配项目资源，精确到 0.1 的粒度
3. 通过数据看板分析资源使用情况，识别资源冲突和优化空间
4. 实现数据的云端持久化存储，支持多设备访问和团队协作
5. 提供灵活的系统配置，支持成员和项目的动态管理

**次要目标**：
- 支持项目状态管理（进行中、已结项、归档）
- 支持导出资源规划数据
- 提供历史数据对比功能
- 支持资源分配数据可视化

### 1.3 目标用户

**主要用户**：
- **团队负责人**：查看整体资源分配，优化资源配置
- **项目经理**：了解项目资源投入，协调资源分配
- **团队成员**：查看自己的项目分配和工作负载

**次要用户**：
- **部门经理**：查看团队资源使用报告
- **HR**：了解人员项目分布情况

---

## 2. 功能需求

### 2.1 核心功能

#### FR1: 资源分配矩阵视图

**功能描述**：提供矩阵式的资源分配视图，行显示团队成员，列显示项目，单元格显示分配比例。

**详细需求**：
- 显示所有"活跃"状态的团队成员
- 显示所有"活跃"状态的项目
- 按周展示资源分配，支持查看未来 13 周的分配情况
- 每个单元格可编辑，支持输入 0.0-1.0 的数值（表示资源投入比例）
- 热力图颜色编码：
  - 浅色：低投入（0.0-0.3）
  - 中等：中等投入（0.4-0.7）
  - 深色：高投入（0.8-1.0）
  - 警告色：过度分配（>1.0）
- 支持删除某个成员在某个项目上的所有分配（按行删除）

**优先级**：P0（必须有）

**验收标准**：
- [ ] 能清晰展示至少 6 个成员和 3 个项目的资源分配
- [ ] 单元格编辑后数据能立即保存到数据库
- [ ] 热力图颜色能准确反映资源投入程度
- [ ] 支持快速删除整行分配

---

#### FR2: 数据看板视图

**功能描述**：提供可视化的数据分析面板，展示资源使用统计和洞察。

**详细需求**：
1. **总体统计卡片**
   - 总成员数
   - 总项目数
   - 活跃项目数
   - 本周总分配数

2. **资源分配趋势图**（折线图）
   - X轴：时间（未来13周）
   - Y轴：资源投入总量
   - 多条线：分别展示不同项目的资源投入趋势

3. **成员工作负载分布**（柱状图）
   - X轴：团队成员
   - Y轴：总投入（所有项目总和）
   - 标识过度分配的成员（>1.0）

4. **项目资源分配饼图**
   - 展示各项目的资源占比
   - 支持点击钻入查看详情

5. **资源利用率分析**
   - 充分利用：0.8-1.0
   - 利用不足：<0.5
   - 过度分配：>1.0
   - 未分配：0.0

**优先级**：P0（必须有）

**验收标准**：
- [ ] 所有图表能实时反映最新数据
- [ ] 图表支持交互（hover 显示详细数据）
- [ ] 能识别并高亮显示资源冲突（过度分配）

---

#### FR3: 系统配置管理

**功能描述**：提供团队成员和项目管理的配置界面。

**详细需求**：

1. **成员管理**
   - 添加新成员：姓名、职位
   - 编辑成员职位
   - 删除成员（级联删除该成员的所有分配数据）
   - 成员列表显示：姓名、职位、操作按钮

2. **项目管理**
   - 添加新项目：项目名称、状态（进行中/已结项）
   - 编辑项目状态
   - 删除项目（级联删除该项目的所有分配数据）
   - 项目归档/激活功能
   - 项目列表显示：项目名称、状态标签、操作按钮

3. **实时保存**
   - 所有修改立即保存到数据库
   - 保存失败时显示错误提示

**优先级**：P0（必须有）

**验收标准**：
- [ ] 能成功添加、编辑、删除成员和项目
- [ ] 删除成员/项目时，相关的分配数据自动清理
- [ ] 数据修改后刷新页面，修改保持生效

---

#### FR4: 数据持久化与同步

**功能描述**：所有数据存储在云端数据库，支持多设备访问和团队协作。

**详细需求**：
1. **云端存储**
   - 使用 Supabase PostgreSQL 数据库
   - 三张主表：members（成员）、projects（项目）、allocations（分配）

2. **实时同步**
   - 修改后立即同步到数据库
   - 支持多用户同时访问（需要添加用户认证，未来功能）
   - 数据冲突处理（最后写入胜出）

3. **离线支持**
   - LocalStorage 作为临时缓存
   - 网络恢复后自动同步

4. **数据备份**
   - 提供 SQL 导出功能
   - 支持数据恢复

**优先级**：P0（必须有）

**验收标准**：
- [ ] 数据修改后刷新页面，数据保持不变
- [ ] 多个设备访问同一个 Supabase 项目，数据一致
- [ ] 数据库连接失败时显示友好的错误提示

---

### 2.2 扩展功能

#### FR5: 数据导出

**功能描述**：支持将资源规划数据导出为 Excel 或图片格式。

**详细需求**：
- 导出为 Excel（.xlsx）
- 导出当前看板截图（PNG）
- 支持选择日期范围导出

**优先级**：P1（重要）

---

#### FR6: 历史数据对比

**功能描述**：支持对比不同时期的资源分配情况。

**详细需求**：
- 选择两个时间点进行对比
- 高亮显示变化部分
- 生成差异报告

**优先级**：P2（一般）

---

#### FR7: 用户认证与权限

**功能描述**：添加用户登录和权限管理。

**详细需求**：
- 团队成员需要登录才能访问
- 不同角色权限：
  - 管理员：完全控制
  - 项目经理：只能查看和编辑
  - 普通成员：只读

**优先级**：P2（未来功能）

---

## 3. 非功能需求

### 3.1 性能要求

| 指标 | 要求 |
|------|------|
| **页面加载时间** | < 3 秒（首次加载） |
| **数据更新响应** | < 100ms（乐观更新） |
| **数据库查询** | < 500ms |
| **并发用户** | 支持 50+ 并发访问 |

### 3.2 可用性要求

| 指标 | 要求 |
|------|------|
| **系统可用性** | 99.5%（每月停机时间 < 3.6 小时） |
| **数据持久性** | 99.9%（使用 Supabase 云存储） |
| **故障恢复时间** | < 1 小时 |

### 3.3 安全性要求

| 指标 | 要求 |
|------|------|
| **数据传输** | HTTPS 加密 |
| **数据库访问** | 使用 Row Level Security (RLS) |
| **API密钥管理** | 环境变量，不硬编码 |
| **敏感数据** | 不记录个人隐私信息 |

### 3.4 兼容性要求

| 指标 | 要求 |
|------|------|
| **浏览器** | Chrome 90+, Firefox 88+, Safari 14+, Edge 90+ |
| **设备** | 桌面端（1920x1080+）、移动端（响应式） |
| **数据库** | Supabase PostgreSQL 15+ |

### 3.5 可维护性要求

| 指标 | 要求 |
|------|------|
| **代码注释率** | > 30% |
| **模块化** | 组件化设计，松耦合 |
| **日志记录** | 关键操作有日志 |
| **错误处理** | 友好的错误提示 |

---

## 4. 用户故事

### US1: 查看资源分配

**作为**团队负责人，**我想要**查看所有成员在各项目上的资源分配，**以便**快速了解团队资源分布情况。

**验收标准**：
- 能在一个页面看到所有成员和项目的分配矩阵
- 能通过热力图颜色快速识别资源投入
- 能切换查看未来 13 周的分配情况

---

### US2: 调整资源分配

**作为**项目经理，**我想要**为成员调整项目资源分配，**以便**应对项目需求变化。

**验收标准**：
- 能直接在矩阵单元格中修改数值
- 修改后立即保存，无需额外操作
- 能看到保存成功/失败的反馈

---

### US3: 分析资源利用率

**作为**团队负责人，**我想要**查看资源利用统计，**以便**发现资源冲突和优化空间。

**验收标准**：
- 能看到总体的资源使用统计
- 能识别哪些成员过度分配（>1.0）
- 能看到各项目的资源占比

---

### US4: 管理团队成员

**作为**团队负责人，**我想要**添加或删除团队成员，**以便**团队人员变动时更新系统。

**验收标准**：
- 能添加新成员并设置职位
- 能删除成员（自动清理相关数据）
- 删除后刷新页面，成员保持删除状态

---

### US5: 数据永久保存

**作为**用户，**我想要**我的数据永久保存在云端，**以便**换设备或清理浏览器缓存后数据不丢失。

**验收标准**：
- 刷新页面后数据保持不变
- 换设备登录后能看到相同数据
- 清除浏览器缓存后数据不丢失

---

## 5. 业务流程

### 5.1 资源规划流程

```
1. 团队负责人创建项目和添加成员
   ↓
2. 为成员分配初始项目资源
   ↓
3. 查看数据看板，分析资源分布
   ↓
4. 根据项目需求调整资源分配
   ↓
5. 识别资源冲突（过度分配）
   ↓
6. 优化资源配置
   ↓
7. 定期review和调整
```

### 5.2 新成员入职流程

```
1. 在系统配置中添加新成员
   ↓
2. 为新成员分配项目资源
   ↓
3. 调整其他成员的分配以平衡资源
   ↓
4. 查看数据看板确认无资源冲突
```

### 5.3 项目结项流程

```
1. 在系统配置中将项目标记为"已结项"
   ↓
2. 逐步释放项目资源（将分配改为 0）
   ↓
3. 将项目归档
   ↓
4. 查看数据看板，重新分配释放的资源
```

---

## 6. 数据模型

### 6.1 实体关系

```
Member (成员)
  ├─ id: 主键
  ├─ name: 姓名
  └─ role: 职位
      │
      ├─ Allocation (分配) *
      │   ├─ id: 主键
      │   ├─ member_id: 外键 → Member
      │   ├─ project_id: 外键 → Project
      │   ├─ week_date: 周日期
      │   └─ value: 分配值 (0.0-1.0)
      │
Project (项目)
  ├─ id: 主键
  ├─ name: 项目名称
  ├─ status: 状态 (active/archived)
  └─ project_status: 项目状态 (ongoing/completed)
```

### 6.2 约束条件

- 一个成员在同一项目同一周只能有一条分配记录
- 删除成员自动级联删除其所有分配记录
- 删除项目自动级联删除其所有分配记录
- 分配值必须在 0.0-1.0 之间（可以超过 1.0 表示过度分配）

---

## 7. 界面原型

### 7.1 主界面布局

```
+------------------+---------------------------------------+
|                  |                                       |
|   侧边栏导航       |           主内容区                    |
|                  |                                       |
|  - 资源分配矩阵    |  - 根据当前视图显示不同内容           |
|  - 数据看板       |                                       |
|  - 系统配置       |                                       |
|                  |                                       |
+------------------+---------------------------------------+
```

### 7.2 资源分配矩阵

```
+------------------------------------------------------------+
|  成员 \ 项目  |  FinTech Migration  |  Real-time Ledger  |  ...
+------------------------------------------------------------+
|  Alice Chen   |  [0.8]             |  [0.5]             |  ...
|  Bob Smith    |  [1.0]             |  [0.0]             |  ...
+------------------------------------------------------------+
```

---

## 8. 术语表

| 术语 | 定义 |
|------|------|
| **资源分配** | 指成员在某个项目上的时间投入比例（0.0-1.0） |
| **过度分配** | 成员在同一周的总投入 >1.0 |
| **热力图** | 用颜色深浅表示数值大小的可视化方式 |
| **乐观更新** | 先更新UI，后台异步保存数据的交互方式 |
| **级联删除** | 删除主记录时自动删除关联记录 |
| **RLS** | Row Level Security，数据库行级安全策略 |

---

## 9. 依赖项

### 9.1 外部依赖

- **Supabase**：云端数据库和认证服务
- **React**：前端框架
- **Vite**：构建工具
- **Recharts**：图表库

### 9.2 数据依赖

- 需要预先创建的成员列表
- 需要预先创建的项目列表
- 历史资源分配数据（可选）

---

## 10. 风险与限制

### 10.1 风险

| 风险 | 影响 | 缓解措施 |
|------|------|----------|
| Supabase 服务中断 | 无法访问数据 | 提供数据导出功能，定期备份 |
| 并发编辑冲突 | 数据不一致 | 添加乐观锁或最后写入胜出策略 |
| 浏览器兼容性 | 部分用户无法使用 | 测试主流浏览器，提供降级方案 |

### 10.2 限制

- 当前版本不支持多人实时协作编辑
- 资源分配精度最高为 0.1
- 最多显示未来 13 周的数据
- 不支持自定义时间范围（固定为按周）

---

## 11. 未来规划

### Phase 2 (Q2 2025)
- [ ] 添加用户认证和权限管理
- [ ] 支持多人实时协作
- [ ] 添加资源分配审批流程
- [ ] 支持按天分配资源（而非按周）

### Phase 3 (Q3 2025)
- [ ] 移动端优化
- [ ] 添加消息通知功能
- [ ] 集成日历视图
- [ ] 支持资源预测和推荐

---

## 12. 附录

### 12.1 参考文档

- [Supabase 官方文档](https://supabase.com/docs)
- [React 官方文档](https://react.dev)
- [Vite 官方文档](https://vitejs.dev)

### 12.2 变更历史

| 版本 | 日期 | 变更内容 | 作者 |
|------|------|----------|------|
| 1.0 | 2025-01-11 | 初始版本 | Claude |

---

**文档结束**
